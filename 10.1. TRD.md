
# TRD(Technical Requirements Document, 기술 요구사항 문서)

제품: **팀하루 – 개발팀 리더용 AI Co‑pilot**  
배포 모델: **SaaS(Software as a Service)** / **AWS Serverless**  
버전: **v0.9(초안)**  
작성일: 2025-09-14  
기본 리전(region): **ap-northeast-2(Seoul)**

---

## 0) 용어/약어 사전

- **SaaS**: 서비스형 소프트웨어(인터넷을 통해 제공되는 구독형 소프트웨어)
    
- **Serverless**: 서버 관리 없이 함수/매니지드 서비스로 구성하는 클라우드 방식(예: AWS Lambda, DynamoDB)
    
- **AWS**: 아마존웹서비스(클라우드 제공자)
    
- **API**: 애플리케이션 프로그래밍 인터페이스(서비스 간 통신 규약)
    
- **JWT**: JSON Web Token(사용자 인증 토큰 포맷)
    
- **IdP**: Identity Provider(신원 제공자, 예: Google, GitHub)
    
- **OAuth 2.0/OIDC**: 표준 인증·인가 프로토콜(소셜 로그인/토큰 교환)
    
- **CDN**: Content Delivery Network(전 세계 캐시로 정적 자산을 빠르게 배포)
    
- **LLM**: 대형 언어 모델(생성형 AI 모델)
    
- **SLO/SLI/SLA**: 서비스 목표/지표/약정(가용성·지연시간 목표)
    
- **RTO/RPO**: 복구시간/복구시점 목표(장애 시 복구 기준)
    
- **PII**: 개인식별정보(개인정보)
    
- **ABAC**: 속성 기반 접근제어(Attribute-Based Access Control)
    
- **P95/P99**: 95/99퍼센타일 지연시간(응답 지연 상위 구간)
    

---

## 1) 문서 목적과 범위

본 TRD는 팀하루 MVP 범위의 **기술적 요구사항**과 **AWS Serverless 아키텍처**를 정의한다. 상위 문서(MRD/PRD/사용자 여정/디자인)를 기술 설계로 변환하여, **개발·보안·운영 팀**이 일관된 기준으로 구현·검증·운영할 수 있도록 한다.

### 1.1 상위 문서 핵심 요약 → 기술 목표로 번역

- **핵심 가치 경험(Aha!)**: “1:1 미팅 10분 준비를 AI가 끝낸다.”
    
    - 기술 목표: 캘린더 기반 **사전 감지** → **브리핑 노트 자동 생성** → **알림 전달**을 **2분 이내** 완료(PRD 비기능 요구)
        
- **필수 기능(에픽)**: AI 성과 평가, 1:1 미팅 어시스턴트, 성장 로드맵 제안(온보딩·연동 포함)
    
    - 기술 목표: GitHub·Google Calendar 안전 연동, 데이터 파이프라인/LLM 생성, 다대다 테넌시(tenant) 격리
        

---

## 2) 비기능 요구사항(NFR, Non‑Functional Requirements)

### 2.1 성능/지연

- 동기 API(일반 조회·쓰기): **P95 < 300 ms**, 페이로드 ≤ 256 KB,
    
- 브리핑 생성(비동기 파이프라인): **평균 60초 이내, P95 120초 이내**, 전체 SLO **≤ 2분**(알림 전송까지)
    
- 대시보드 최초 페인트(LCP): 2.0 s 이하(유선), 3.0 s 이하(무선)
    

### 2.2 가용성/내결함성

- API 가용성 **99.9%/월**. 단일 리전 운영(초기) + 스테이트리스(stateless) 구성.
    
- 장애 격리: 큐/스텝함수로 다운스트림 장애 **흔들림 완충**(서킷브레이커·재시도·DLQ).
    

### 2.3 보안/개인정보

- 전송/저장 **암호화(E2E TLS, KMS)**, 비밀정보는 **Secrets Manager**.
    
- **최소 권한(Least Privilege)**, 테넌트 레벨 **행(row) 단위 격리**(DynamoDB 파티션키), **감사로그** 보존 1년.
    
- OAuth 스코프 최소화(GitHub, Google), 토큰은 KMS로 암호화 후 저장.
    

### 2.4 준법/컴플라이언스

- **데이터 지역성**: ap-northeast-2 내 저장 기본.
    
- **삭제권/보존정책**: 사용자 삭제 요청 시 30일 이내 완전 삭제, 백업은 35일 보존.
    

### 2.5 관측성/운영

- **표준 메트릭**(지연, 오류율, 비용, LLM 호출량), **테넌트 태깅**으로 분리 관찰.
    
- 추적/상관: **AWS X‑Ray + Correlation‑ID**.
    
- 경보: **CloudWatch Alarms → SNS → Slack/이메일**.
    

### 2.6 비용 가드레일

- 월간 상한 **예산 알림**(AWS Budgets). LLM 호출, Step Functions, DynamoDB RCU/WCU 자동 확장 한도 설정.    
- 브리핑 생성 배치 **샘플링/요약 캐시**로 LLM 토큰 비용 상한.
- **NAT 사용량 0을 기준선**으로 예산/경보 설정. 발생 시 즉시 RCA
    

---

## 3) 시스템 아키텍처(개요)

**프런트엔드**: React/Next.js 정적 빌드(S3) + **CloudFront(CDN)** + **WAF**.  
**인증/권한**: **Cognito(Hosted UI)** + OIDC(Google/GitHub).  
**백엔드 API**: **API Gateway(HTTP)** → **Lambda**(TypeScript/Node) → **DynamoDB**.  
**파일/리포트**: S3(버전·수명주기), 서빙은 사전 서명 URL.  
**비동기/오케스트레이션**: **EventBridge**(스케줄/버스), **Step Functions**(브리핑 생성), **SQS**(완충·DLQ).  
**AI/LLM**: **Amazon Bedrock**(모델 추상층) + **프롬프트/가드레일** 레이어.  
**알림**: **SES(이메일)** / Slack App(Webhook/API).  
**로그/모니터링**: CloudWatch Logs, X‑Ray, Athena+S3(감사).  
**IaC**: AWS **CDK**(TypeScript) + CodePipeline(또는 GitHub Actions) 배포.
**네트워크 기본값**: Lambda는 VPC 미연결. VPC 도입 시 S3/DynamoDB는 **게이트웨이 엔드포인트** 우선

> 선택(후속): AppSync(GraphQL)·OpenSearch(검색)·Kinesis(대량 이벤트).

---

## 4) 멀티테넌시 설계(보안 격리)

- **테넌트 정의**: 하나의 ‘팀/조직’ = Tenant. Cognito 그룹/커스텀 클레임(`tenantId`) 발급.
    
- **데이터 격리**: DynamoDB 파티션키에 **`tenantId` 선행 구성**(예: `PK = TENANT#<tenantId>#USER#<userId>`). 앱 레벨 **정책 가드**(미들웨어)로 요청당 `tenantId` 일치 검증.
    
- **스코프 격리**: S3 객체 키 프리픽스 `tenantId/…`, 사전 서명 URL 생성 시 **ABAC**로 접근 제한.
    
- **운영 격리**: 메트릭·로그에 `tenantId` 태그 필수, 비용/성능 이상 탐지 시 테넌트별 차단/스로틀.
    

---

## 5) 데이터 모델(초안, DynamoDB 단일테이블 설계)

> 단일테이블로 조인 비용을 제거하고, 액세스 패턴(조회 키)을 우선한다.

### 5.1 테이블 `th_prod`

- **PK/SK(필수)**: 파티션키/정렬키. 예)
    
    - 사용자: `PK=TENANT#t1#USER#u1`, `SK=PROFILE`
        
    - 팀: `PK=TENANT#t1#TEAM#t1`, `SK=PROFILE`
        
    - 연결 토큰: `PK=TENANT#t1#USER#u1`, `SK=CONN#github`
        
    - 활동 요약: `PK=TENANT#t1#USER#u1`, `SK=SUMMARY#2025-09-07`
        
    - 브리핑 노트: `PK=TENANT#t1#MEETING#<eventId>`, `SK=BRIEFING#v1`
        
    - 로드맵 항목: `PK=TENANT#t1#USER#u1`, `SK=ROADMAP#k8s-basics`
        
- **GSI(보조 인덱스)**:
    
    - `GSI1`: `GSI1PK=TENANT#t1#MEETING`, `GSI1SK=<startAt>` (다가올 1:1 조회)
        
    - `GSI2`: `GSI2PK=TENANT#t1#USER#u1#SUMMARY`, `GSI2SK=<week>` (주간 요약 타임라인)
        
- **TTL**: 임시 토큰/임시 요약에 TTL 적용(예: 7~30일).
    
- **크기 가드**: 항목 400KB 이하, 큰 리포트는 S3에 저장하고 DynamoDB엔 메타만.
    

### 5.2 S3 버킷

- `th-briefings-prod`: 브리핑 HTML/JSON, 프리픽스 `tenantId/eventId/timestamp.json`
    
- 수명주기: 90일 후 Glacier, 365일 후 삭제(정책에 따라 조정)
    

---

## 6) 외부 연동(보안 우선)

### 6.1 Google Calendar

- **OAuth 2.0**: 최소 스코프(`calendar.readonly`), 리다이렉트는 Cognito Hosted UI.
    
- **이벤트 감지**: EventBridge 스케줄러가 5분 간격 **다음 24h 캘린더**를 스캔(참석자=2, 제목 키워드 `1:1|one-on-one`).
    

### 6.2 GitHub

- **OAuth App**: 스코프 `repo:read`, `read:org`(필요 최소).
    
- **데이터**: 지난 7일 커밋/PR/리뷰 코멘트 집계(레이트 리밋 고려).
    

### 6.3 Slack/Email

- Slack App(봇 토큰, 채널 스코프 최소) 또는 Incoming Webhook.
    
- SES는 도메인 인증 완료 후 **DMARC/SPF/DKIM** 설정.
    

---

## 7) 주요 워크플로우

### 7.1 “Aha!”: 1:1 브리핑 자동 생성(2분 이내)

1. **감지**: EventBridge(5분 주기) → 60~90분 후 시작 예정 1:1 식별
    
2. **오케스트레이션**: Step Functions 실행(`GenerateBriefing(state)`):  
    a. GitHub 주간 요약 Lambda → 캐시 조회 후 미스 시 새로 생성  
    b. 로드맵/목표 진행 조회 Lambda  
    c. 리스크 힌트 룰(커밋 편향/학습 부재)  
    d. **Bedrock 호출**: 요약 합성 + “추천 질문” 생성  
    e. 결과 S3 저장 + DynamoDB 메타쓰기
    
3. **알림**: SES/Slack으로 링크 발송(사전 서명 URL)
    
4. **SLO 체크**: 전 단계 소요 시간을 메트릭으로 집계, P95 120초 준수.
    

### 7.2 사용자 온보딩

- Cognito Hosted UI(이메일/패스워드 + Google/GitHub). 최초 로그인 시 **팀 생성** → **초대 링크** 발급.
    

### 7.3 성장 로드맵 제안

- 팀 목표/스택 입력 → 규칙+LLM로 개인 초안 생성(수정/확정/공유). 변경분은 이벤트 소싱(`ROADMAP_UPDATED`).
    

---

## 8) API 설계(핵심만)

- **인증**: Cognito JWT(헤더 `Authorization: Bearer`), Lambda Authorizer로 `tenantId` 바인딩.
    
- **버전**: `/v1/*` 고정, 멱등성 키(`Idempotency-Key`) 지원.
    

예시

- `GET /v1/teams/{teamId}/meetings?from=...&to=...` – 다가올 1:1 목록
    
- `POST /v1/meetings/{eventId}/briefing:generate` – 브리핑 수동 생성 트리거(권한 제한)
    
- `GET /v1/users/{userId}/summaries?week=YYYY-WW` – 주간 성과 요약 조회
    
- `PUT /v1/users/{userId}/roadmap` – 성장 로드맵 확정/수정
    

에러 포맷

```json
{ "code": "FORBIDDEN", "message": "tenant mismatch", "correlationId": "..." }
```

---

## 9) AI/LLM 파이프라인

- **모델 계층**: Bedrock 모델 추상(프로바이더 교체 가능), 프롬프트 템플릿 버전 관리.
    
- **가드레일**: 입력 필터링(PII 최소화), 출력 길이·형식 제한(JSON 스키마 검증), 유사도 캐시(재생성 방지).
    
- **품질 측정**: 자동 채점(핵심 토픽 포함률), 인적 샘플링 리뷰.
    
- **비용**: 테넌트별 토큰 사용량 메트릭/경보, 상한 초과 시 요약 깊이 하향/지연 생성.
    

---

## 10) 보안 설계

- **인증/인가**: Cognito 사용자풀 + 그룹/속성(`tenantId`, `role`). 백엔드에서 역할별 정책(관리자/멤버) 체크.
    
- **암호화**: KMS CMK(고객 관리형 키)로 S3/DynamoDB/Secrets 암호화.
    
- **네트워크**: 공용 엔드포인트는 **WAF** 앞단(OWASP Top10 룰), 레이트리밋.
    
- **감사/추적**: 모든 위험 액션(로그인, 권한 변경, 초대/삭제, 데이터 조회) **감사 이벤트** 기록.
    
- **비밀/토큰**: 사용자별 OAuth 리프레시 토큰은 KMS로 암호화 후 DynamoDB 저장(키 분할/로테이션).
- 공용 엔드포인트는 WAF 앞단 보호. **NAT 게이트웨이는 예외 승인 항목**으로 관리
    

---

## 11) 프런트엔드/호스팅

- **정적 자산**: S3 + CloudFront, 무중단 배포(버킷 버전/오브젝트 무효화).
    
- **국제화**: 다국어 토글(ko/en), 숫자/날짜 로케일.
    
- **접근성**: 대비 4.5:1, 키보드 내비, `prefers-reduced-motion` 준수.
    

---

## 12) DevOps/배포 파이프라인

- **IaC**: AWS CDK(스택 분리: 네트워킹/데이터/앱/관측).
    
- **CI/CD**: CodePipeline or GitHub Actions → CDK Deploy, Lambda **그레이드릴리즈**(Alias+CodeDeploy).
    
- **피처 플래그**: AWS AppConfig.
    
- **환경**: `dev`/`stg`/`prod` 별도 AWS 계정.
    

---

## 13) 관측성/지표(테넌트 인식)

- **핵심 SLI**: API 오류율, API 지연(P50/P95), 브리핑 생성 총소요, 브리핑 성공률, LLM 호출 실패율, 온보딩 전환율(가입→연동→첫 브리핑).
    
- **로그 표준**: JSON 로그 + `correlationId` + `tenantId`.
    
- **대시보드**: CloudWatch Dashboard + QuickSight(경영 뷰 선택).
    

---

## 14) 테스트 전략

- **계약 테스트**: API 스키마 검증, 멱등성 확인.
    
- **부하 테스트**: 브리핑 동시 생성 100/분에서 P95 < 120초 유지.
    
- **혼돈 연습**: 외부 API(깃허브/구글) 429/503 시 재시도/백오프 검증.
    
- **보안 테스트**: 테넌트 가로읽기 금지 테스트, JWT 위조 시나리오.
    

---

## 15) 릴리스/롤아웃

- **베타(Private)**: 5~10팀, 기능 플래그로 범위 제어.
    
- **피드백 루프**: 브리핑 노트 하단 ‘정확도/유용성’ 원클릭 평가 수집.
    
- **요금제 게이팅**: Stripe(초기)로 결제/구독, 기능 제한은 Cognito 그룹/플래그로 연동.
    

---

## 16) DR/백업

- **RTO 4시간 / RPO 15분**(초기 가정).
    
- DynamoDB Point‑in‑Time Recovery, S3 버전·크로스리전 복제(선택).
    
- IaC로 **재현 가능한 재배포** 절차 문서화.
    

---

## 17) 비용(러프 가정)

- 사용자 200명/팀 20개, 1:1 미팅 주 1회/팀 기준:    
    - Lambda/Step Functions: 수십 달러/월        
    - DynamoDB 온디맨드: 수십 달러/월(요약 캐시로 상한)        
    - LLM(Bedrock): 수백 달러/월(브리핑당 평균 토큰 예산 5~10k)
    - 본 비용 가정은 **NAT=0** 전제를 따른다
        

---

## 18) 설계 선택의 비판적 검토(Trade‑offs)

- **Serverless vs 컨테이너**: 운영 부담/초기 비용은 유리, 장기 초고정적 트래픽엔 컨테이너가 유리할 수 있음(콜드스타트/단위 비용).
    
- **DynamoDB vs RDB(PostgreSQL)**: 액세스 패턴 확정 전제에서 DynamoDB가 단순·저지연. 복잡한 조인/애드혹 질의는 RDB가 유리(AppSync+OpenSearch로 보완 검토).
    
- **REST(API Gateway) vs GraphQL(AppSync)**: 초기 REST가 단순. 클라이언트 주도 데이터 결합/실시간 구독 필요 시 GraphQL 전환.
    
- **Bedrock vs 외부 LLM API**: 데이터 지역/권한·감사에 Bedrock이 유리. 모델 다양성·최신성은 외부가 유리할 수 있으나 규제·거버넌스 고려.
    

---

## 19) 남은 의사결정(결정 기한: 베타 전)

- **요금제/한도**: 브리핑 생성 주기/최대치(테넌트별 상한).
    
- **Slack 의존도**: 이메일 대비 Slack 우선 여부.
    
- **트렌드 요약**: 외부 뉴스/블로그 스캔 범위(저작권/수집정책 검토).
    
- **AppSync 도입 시점**: 구독/실시간 알림 클라이언트 업데이트 필요 시.
    

---

## 부록 A) 브리핑 생성 Step Functions(의사 다이어그램)

```
[Detect 1:1] --> [Start SFN]
   --> (Lambda: Load Cached Summaries?)
       --> No: (Lambda: Pull GH) -> (Lambda: Aggregate)
   --> (Lambda: Load Roadmap/Goals)
   --> (Lambda: Risk Rules)
   --> (Bedrock: Compose Briefing + Questions)
   --> (S3 Put + DynamoDB Put)
   --> (Notify: SES/Slack)
```

## 부록 B) 권한(요약)

- Lambda 실행 역할: 최소 리소스 권한, S3 Put/Get(프리픽스 제한), DynamoDB CRUD(파티션키 범위 제한), Bedrock Invoke, Secrets Get.
    
- Cognito: Google/GitHub IdP 연결, 토큰에 `tenantId`, `role` 포함.
    

## 부록 C) 실패·재시도 표준

- 외부 API 429/5xx: 지수 백오프 최대 5회, 서킷브레이커 2분, DLQ 적재, 경보 발송.
    

## 부록 D) 프런트엔드 번들 가드

- 이미지 지연로드, 폰트 woff2, 번들 스플릿, CloudFront 캐시 무효화 전략(릴리스 노트와 동기화).